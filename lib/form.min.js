!function e(s,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("form",[],t):"object"==typeof exports?exports.form=t():s.form=t()}(this,function(){return function(e){function s(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,s),o.l=!0,o.exports}var t={};return s.m=e,s.c=t,s.i=function(e){return e},s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},s.n=function(e){var t=e&&e.__esModule?function s(){return e.default}:function s(){return e};return s.d(t,"a",t),t},s.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},s.p="",s(s.s=0)}([function(e,s,t){var r,o,n;!function(t,i){var a;o=[s],r=i,n="function"==typeof r?r.apply(s,o):r,!(void 0!==n&&(e.exports=n))}(this,function(e){"use strict";function s(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function t(e,s){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!s||"object"!=typeof s&&"function"!=typeof s?e:s}function r(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function, not "+typeof s);e.prototype=Object.create(s&&s.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(e,s):e.__proto__=s)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function e(e,s){for(var t=0;t<s.length;t++){var r=s[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(s,t,r){return t&&e(s.prototype,t),r&&e(s,r),s}}(),n=0,i=1,a=2,c=function(e){function c(){return s(this,c),t(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}return r(c,e),o(c,[{key:"init",value:function e(){this.isLoading=!1,this.$form=this.$("form"),this.$feedback=this.$("[data-feedback]"),this.$progress=this.$("[data-progress]"),this.$form.noValidate=!0,this.addEventListener(this.$form,"submit",this._submitListener()),this.addEventListener(this.$form,"reset",this._resetListener())}},{key:"fetch",value:function e(s,t){var r=this;return new Promise(function(e,o){var n=new XMLHttpRequest;r.currentRequest=n,base.eventHub.trigger("form:beforeSend",t,n),r.trigger("beforeSend",t,n),n.withCredentials=!0,n.open(t.method||"post",s);for(var i in t.headers||{})t.headers.hasOwnProperty(i)&&n.setRequestHeader(i,t.headers[i]);n.onload=e,n.onerror=o,n.onabort=o,n.ontimeout=o,r.$progress&&n.upload&&(n.upload.onprogress=r._onProgress()),n.send(t.body)}).then(function(e){r.currentRequest=null;var s=e.target;if(s.status>=200&&s.status<300)return e;var t=new Error(s.statusText);throw t.response=e,t}).then(function(e){var s=e.target,t=JSON.parse(s.responseText);return{json:t,request:s}})}},{key:"showFeedback",value:function e(s){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;switch(this.$feedback.innerHTML=s,t){case i:this.$feedback.classList.add(this.options.feedbackClassWarning);break;case a:this.$feedback.classList.add(this.options.feedbackClassError);break;case n:default:this.$feedback.classList.add(this.options.feedbackClassSuccess)}}},{key:"resetFeedback",value:function e(){this.$feedback.innerHTML="",this.$feedback.classList.remove(this.options.feedbackClassWarning),this.$feedback.classList.remove(this.options.feedbackClassError),this.$feedback.classList.remove(this.options.feedbackClassSuccess)}},{key:"resetValidation",value:function e(){var s=this,t=this.$$("."+this.options.formFieldClass);t.forEach(function(e){var t=e.querySelector(s.options.formFieldMessageElement+"."+s.options.formFieldMessageClass);e.classList.remove(s.options.formFieldClassError),t&&t.parentNode.removeChild(t)})}},{key:"resetProgress",value:function e(){this.$progress&&(this.$progress.classList.remove(this.options.progressClassShow),this.setProgress(0))}},{key:"setProgress",value:function e(s){if(this.$progress&&this.options.showProgress){0===s||1===s&&this.options.hideProgressOnEnd?this.$progress.classList.remove(this.options.progressClassShow):this.$progress.classList.add(this.options.progressClassShow),s*=100;var t=Math.ceil(s),r=this.$progress.querySelector("[data-loaded]"),o=this.$progress.querySelector("[data-percentage]");r.style.width=t+"%",o.textContent=t+"%"}}},{key:"displayFieldErrors",value:function e(s){for(var t in s)if(s.hasOwnProperty(t)){var r=this.options.getFieldErrors.call(this,t,s),o=this.options.getErrorField.call(this,t);if(o){o.classList.add(this.options.formFieldClassError);var n=o.querySelector(this.options.formFieldMessageElement+"."+this.options.formFieldMessageClass);n||(n=document.createElement(this.options.formFieldMessageElement),n.classList.add(this.options.formFieldMessageClass),o.appendChild(n)),n.innerHTML="";var i=document.createElement("span");i.textContent=r[0],n.appendChild(i)}}}},{key:"_createFormData",value:function e(){var s=new FormData(this.$form);return s}},{key:"_onProgress",value:function e(){var s=this;return function(e){e.lengthComputable&&s.setProgress(e.loaded/e.total)}}},{key:"_resetListener",value:function e(){var s=this;return function(){s.currentRequest&&s.currentRequest.abort(),s.resetProgress(),s.resetFeedback(),s.resetValidation()}}},{key:"_submitListener",value:function e(){var s=this;return function(e){if(e.preventDefault(),!s.isLoading){s.isLoading=!0;var t=s._createFormData(),r=s.$form.getAttribute("action"),o=s.$form.getAttribute("method");s.resetProgress(),s.resetFeedback(),s.resetValidation(),s.node.classList.add(s.options.classLoading),s.fetch(r,{body:t,method:o}).then(function(e){if(base.eventHub.trigger("form:send",e),s.trigger("send",e),s.isLoading=!1,s.node.classList.remove(s.options.classLoading),e.json.success)base.eventHub.trigger("form:sendSuccess",e),s.trigger("sendSuccess",e),s.showFeedback(e.json.message||s.options.defaultSuccessMessage),s.options.removeFormOnSuccess&&(s.$form.parentNode.removeChild(s.$form),s.options.scroller&&window.setTimeout(function(){s.options.scroller.toElement(s.$feedback||s.node)},0));else{base.eventHub.trigger("form:sendError",e),s.trigger("sendError",e);var t=s.options.findFieldErrors(e.json);t?(s.displayFieldErrors(t),e.json.message&&s.showFeedback(e.json.message,a)):s.showFeedback(e.json.message||s.options.defaultErrorMessage,a)}}).catch(function(e){if(s.isLoading=!1,s.node.classList.remove(s.options.classLoading),e.type&&"abort"!==e.type)throw s.showFeedback(s.options.defaultErrorMessage,n),e})}}}}]),c}(base.features.Feature);c.defaultOptions={scroller:null,defaultSuccessMessage:"Nachricht wurde erfolgreich versendet!",defaultErrorMessage:"Beim Senden der Nachricht ist ein Fehler aufgetreten!",classLoading:"-loading",removeFormOnSuccess:!0,showProgress:!0,hideProgressOnEnd:!0,progressClassShow:"-show",formFieldClass:"form-field",formFieldClassError:"-error",formFieldMessageElement:"div",formFieldMessageClass:"message",feedbackClassSuccess:"-success",feedbackClassWarning:"-warning",feedbackClassError:"-error",findFieldErrors:function e(s){return s.errors},getErrorField:function e(s){var t=this.$form.querySelector('[name="fields['+s+']"]');return t?t.closest("."+this.options.formFieldClass):null},getFieldErrors:function e(s,t){return t[s]}},e.default=c})}])});
//# sourceMappingURL=form.min.js.map